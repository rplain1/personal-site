{
  "hash": "40a463d6f467397276cfb20c79b9b6c3",
  "result": {
    "markdown": "---\ntitle: \"Complicated Keeper Data Manipulation\"\ndescription: |\n  How to leverage {ffscrapr} to implement a complicated keeper logic.\nauthor:\n  - name: Ryan Plain\ndate: 03-21-2021\noutput:\n  distill::distill_article:\n    self_contained: false\n---\n\n\n\n\nMy previous post dove in on sample analysis of our fantasy football league utilizing the API from [Sleeper](https://sleeper.app/). Since then, I have discovered an amazing package [**{ffscrapr}**](https://ffscrapr.dynastyprocess.com) on CRAN, developed by [Tan](https://twitter.com/_TanHo). This package does everything for you to get data from Sleeper into easy to work with data frames.\n\n## The Goal\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](img/keepers.png){width=100%}\n:::\n:::\n\n\nEach year we draft players for the upcoming season, which is typically referred to as *redraft* format. A couple years ago we began a *keeper* format where we can keep a player from the previous year.\n\nThere are several ways to implement a keeper format, our rules are as follows:\n\n-   Keep 1 player, that player can not be kept consecutive years\\\n-   The kept player will be kept at the round they were drafted in with a single round penalty (i.e. if you drafted a player in round 10, you would keep them in round 9 the following year)\\\n-   If you trade a player, the new team gets the rights to keep that player\\\n-   The player must remain on the roster at least until the week before their respective bye week\n\nAs you can imagine, this is a nightmare to track in a spreadsheet as a commissioner.\n\n------------------------------------------------------------------------\n\n## The Solution\n\nOnly a few packages needed (if you count **{tidyverse}** as a few that is) to begin the analysis.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n:::\n\n\n## ffscrapr\n\nTan has well documented how the package works through the **{ffscraper}** website. I won't go into too much detail, as the API is fairly simple to understand from the function names alone. Basically, create a *league* object and get the draft picks and transactions for it.\n\nThe league I will be focusing on is a leauge is called *The Hot Boyz*... Hopefully Dallas Cowboys fans understand!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_leagues <- ffscrapr::sleeper_userleagues(\"rplain\", 2020)\n\nleague_id <- my_leagues %>% \n  filter(league_name == 'The Hot Boyz') %>% \n  pull(league_id)\n\nmy_league <- ffscrapr::ff_connect(platform = 'sleeper', \n                                  season = 2020, \n                                  league_id = league_id)\n\ntransactions <- ff_transactions(my_league)\n\ndraft_picks <- ff_draft(my_league) \n```\n:::\n\n\n------------------------------------------------------------------------\n\nBelow is what the draft board looked like following the draft.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndraft_picks %>% \n  select(round, pick, franchise_name, player_name, pos, team) %>% \n   mutate(player_name = ifelse(is.na(player_name), paste(team, \" Def\"), player_name)) %>% \n  pivot_wider(\n    id_cols = round,\n    names_from = franchise_name,\n    values_from = player_name\n  ) %>% \n  `colnames<-`(c(\"Round\",1:10)) %>% \n  gt::gt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"knognweqmi\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#knognweqmi .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#knognweqmi .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#knognweqmi .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#knognweqmi .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#knognweqmi .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#knognweqmi .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#knognweqmi .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#knognweqmi .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#knognweqmi .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#knognweqmi .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#knognweqmi .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#knognweqmi .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#knognweqmi .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#knognweqmi .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#knognweqmi .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#knognweqmi .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#knognweqmi .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#knognweqmi .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#knognweqmi .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#knognweqmi .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#knognweqmi .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#knognweqmi .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#knognweqmi .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#knognweqmi .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#knognweqmi .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#knognweqmi .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#knognweqmi .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#knognweqmi .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#knognweqmi .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#knognweqmi .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#knognweqmi .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#knognweqmi .gt_left {\n  text-align: left;\n}\n\n#knognweqmi .gt_center {\n  text-align: center;\n}\n\n#knognweqmi .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#knognweqmi .gt_font_normal {\n  font-weight: normal;\n}\n\n#knognweqmi .gt_font_bold {\n  font-weight: bold;\n}\n\n#knognweqmi .gt_font_italic {\n  font-style: italic;\n}\n\n#knognweqmi .gt_super {\n  font-size: 65%;\n}\n\n#knognweqmi .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#knognweqmi .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#knognweqmi .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#knognweqmi .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#knognweqmi .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#knognweqmi .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Round</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">1</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">2</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">3</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">4</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">5</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">6</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">7</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">8</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">9</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">10</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_left\">Christian McCaffrey</td>\n<td class=\"gt_row gt_left\">Ezekiel Elliott</td>\n<td class=\"gt_row gt_left\">Saquon Barkley</td>\n<td class=\"gt_row gt_left\">Michael Thomas</td>\n<td class=\"gt_row gt_left\">Dalvin Cook</td>\n<td class=\"gt_row gt_left\">Alvin Kamara</td>\n<td class=\"gt_row gt_left\">Le'Veon Bell</td>\n<td class=\"gt_row gt_left\">Joe Mixon</td>\n<td class=\"gt_row gt_left\">Miles Sanders</td>\n<td class=\"gt_row gt_left\">Davante Adams</td></tr>\n    <tr><td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_left\">Chris Godwin</td>\n<td class=\"gt_row gt_left\">Josh Jacobs</td>\n<td class=\"gt_row gt_left\">DeAndre Hopkins</td>\n<td class=\"gt_row gt_left\">Travis Kelce</td>\n<td class=\"gt_row gt_left\">Tyreek Hill</td>\n<td class=\"gt_row gt_left\">Patrick Mahomes</td>\n<td class=\"gt_row gt_left\">Nick Chubb</td>\n<td class=\"gt_row gt_left\">Chris Carson</td>\n<td class=\"gt_row gt_left\">Julio Jones</td>\n<td class=\"gt_row gt_left\">Clyde Edwards-Helaire</td></tr>\n    <tr><td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_left\">James Conner</td>\n<td class=\"gt_row gt_left\">Mike Evans</td>\n<td class=\"gt_row gt_left\">Austin Ekeler</td>\n<td class=\"gt_row gt_left\">David Johnson</td>\n<td class=\"gt_row gt_left\">George Kittle</td>\n<td class=\"gt_row gt_left\">Adam Thielen</td>\n<td class=\"gt_row gt_left\">Todd Gurley</td>\n<td class=\"gt_row gt_left\">Kenny Golladay</td>\n<td class=\"gt_row gt_left\">Jonathan Taylor</td>\n<td class=\"gt_row gt_left\">Mark Andrews</td></tr>\n    <tr><td class=\"gt_row gt_right\">4</td>\n<td class=\"gt_row gt_left\">Robert Woods</td>\n<td class=\"gt_row gt_left\">JuJu Smith-Schuster</td>\n<td class=\"gt_row gt_left\">Amari Cooper</td>\n<td class=\"gt_row gt_left\">Aaron Jones</td>\n<td class=\"gt_row gt_left\">Melvin Gordon</td>\n<td class=\"gt_row gt_left\">Calvin Ridley</td>\n<td class=\"gt_row gt_left\">Raheem Mostert</td>\n<td class=\"gt_row gt_left\">Allen Robinson</td>\n<td class=\"gt_row gt_left\">Odell Beckham</td>\n<td class=\"gt_row gt_left\">Derrick Henry</td></tr>\n    <tr><td class=\"gt_row gt_right\">5</td>\n<td class=\"gt_row gt_left\">Mark Ingram</td>\n<td class=\"gt_row gt_left\">A.J. Brown</td>\n<td class=\"gt_row gt_left\">Kareem Hunt</td>\n<td class=\"gt_row gt_left\">Cooper Kupp</td>\n<td class=\"gt_row gt_left\">D.J. Chark</td>\n<td class=\"gt_row gt_left\">Zach Ertz</td>\n<td class=\"gt_row gt_left\">Stefon Diggs</td>\n<td class=\"gt_row gt_left\">Keenan Allen</td>\n<td class=\"gt_row gt_left\">D.J. Moore</td>\n<td class=\"gt_row gt_left\">Terry McLaurin</td></tr>\n    <tr><td class=\"gt_row gt_right\">6</td>\n<td class=\"gt_row gt_left\">Michael Gallup</td>\n<td class=\"gt_row gt_left\">Marquise Brown</td>\n<td class=\"gt_row gt_left\">Devin Singletary</td>\n<td class=\"gt_row gt_left\">Russell Wilson</td>\n<td class=\"gt_row gt_left\">Dak Prescott</td>\n<td class=\"gt_row gt_left\">Kenyan Drake</td>\n<td class=\"gt_row gt_left\">Tyler Lockett</td>\n<td class=\"gt_row gt_left\">T.Y. Hilton</td>\n<td class=\"gt_row gt_left\">Cam Akers</td>\n<td class=\"gt_row gt_left\">Deshaun Watson</td></tr>\n    <tr><td class=\"gt_row gt_right\">7</td>\n<td class=\"gt_row gt_left\">Antonio Gibson</td>\n<td class=\"gt_row gt_left\">J.K. Dobbins</td>\n<td class=\"gt_row gt_left\">Darren Waller</td>\n<td class=\"gt_row gt_left\">David Montgomery</td>\n<td class=\"gt_row gt_left\">Leonard Fournette</td>\n<td class=\"gt_row gt_left\">DeVante Parker</td>\n<td class=\"gt_row gt_left\">Will Fuller</td>\n<td class=\"gt_row gt_left\">Marlon Mack</td>\n<td class=\"gt_row gt_left\">Zack Moss</td>\n<td class=\"gt_row gt_left\">Tyler Boyd</td></tr>\n    <tr><td class=\"gt_row gt_right\">8</td>\n<td class=\"gt_row gt_left\">Brandin Cooks</td>\n<td class=\"gt_row gt_left\">Ronald Jones</td>\n<td class=\"gt_row gt_left\">A.J. Green</td>\n<td class=\"gt_row gt_left\">Scott Miller</td>\n<td class=\"gt_row gt_left\">SF  Def</td>\n<td class=\"gt_row gt_left\">James White</td>\n<td class=\"gt_row gt_left\">Rob Gronkowski</td>\n<td class=\"gt_row gt_left\">Evan Engram</td>\n<td class=\"gt_row gt_left\">Kyler Murray</td>\n<td class=\"gt_row gt_left\">Julian Edelman</td></tr>\n    <tr><td class=\"gt_row gt_right\">9</td>\n<td class=\"gt_row gt_left\">Lamar Jackson</td>\n<td class=\"gt_row gt_left\">CeeDee Lamb</td>\n<td class=\"gt_row gt_left\">Jerry Jeudy</td>\n<td class=\"gt_row gt_left\">Jordan Howard</td>\n<td class=\"gt_row gt_left\">Diontae Johnson</td>\n<td class=\"gt_row gt_left\">Henry Ruggs</td>\n<td class=\"gt_row gt_left\">Tyler Higbee</td>\n<td class=\"gt_row gt_left\">D'Andre Swift</td>\n<td class=\"gt_row gt_left\">Deebo Samuel</td>\n<td class=\"gt_row gt_left\">Jarvis Landry</td></tr>\n    <tr><td class=\"gt_row gt_right\">10</td>\n<td class=\"gt_row gt_left\">Noah Fant</td>\n<td class=\"gt_row gt_left\">Jared Cook</td>\n<td class=\"gt_row gt_left\">Matt Ryan</td>\n<td class=\"gt_row gt_left\">Hayden Hurst</td>\n<td class=\"gt_row gt_left\">Emmanuel Sanders</td>\n<td class=\"gt_row gt_left\">Austin Hooper</td>\n<td class=\"gt_row gt_left\">Cam Newton</td>\n<td class=\"gt_row gt_left\">Marvin Jones</td>\n<td class=\"gt_row gt_left\">Tarik Cohen</td>\n<td class=\"gt_row gt_left\">Matt Breida</td></tr>\n    <tr><td class=\"gt_row gt_right\">11</td>\n<td class=\"gt_row gt_left\">PIT  Def</td>\n<td class=\"gt_row gt_left\">Tom Brady</td>\n<td class=\"gt_row gt_left\">John Brown</td>\n<td class=\"gt_row gt_left\">Phillip Lindsay</td>\n<td class=\"gt_row gt_left\">Christian Kirk</td>\n<td class=\"gt_row gt_left\">BAL  Def</td>\n<td class=\"gt_row gt_left\">NE  Def</td>\n<td class=\"gt_row gt_left\">Chris Thompson</td>\n<td class=\"gt_row gt_left\">Chase Edmonds</td>\n<td class=\"gt_row gt_left\">Jamison Crowder</td></tr>\n    <tr><td class=\"gt_row gt_right\">12</td>\n<td class=\"gt_row gt_left\">Tony Pollard</td>\n<td class=\"gt_row gt_left\">Kerryon Johnson</td>\n<td class=\"gt_row gt_left\">Justin Jefferson</td>\n<td class=\"gt_row gt_left\">BUF  Def</td>\n<td class=\"gt_row gt_left\">Tevin Coleman</td>\n<td class=\"gt_row gt_left\">Sony Michel</td>\n<td class=\"gt_row gt_left\">Sterling Shepard</td>\n<td class=\"gt_row gt_left\">Latavius Murray</td>\n<td class=\"gt_row gt_left\">Damien Harris</td>\n<td class=\"gt_row gt_left\">Aaron Rodgers</td></tr>\n    <tr><td class=\"gt_row gt_right\">13</td>\n<td class=\"gt_row gt_left\">Anthony Miller</td>\n<td class=\"gt_row gt_left\">Mecole Hardman</td>\n<td class=\"gt_row gt_left\">Blake Jarwin</td>\n<td class=\"gt_row gt_left\">Alexander Mattison</td>\n<td class=\"gt_row gt_left\">Darius Slayton</td>\n<td class=\"gt_row gt_left\">Joe Burrow</td>\n<td class=\"gt_row gt_left\">Courtland Sutton</td>\n<td class=\"gt_row gt_left\">Josh Allen</td>\n<td class=\"gt_row gt_left\">Preston Williams</td>\n<td class=\"gt_row gt_left\">Hunter Henry</td></tr>\n    <tr><td class=\"gt_row gt_right\">14</td>\n<td class=\"gt_row gt_left\">Golden Tate</td>\n<td class=\"gt_row gt_left\">O.J. Howard</td>\n<td class=\"gt_row gt_left\">Josh Gordon</td>\n<td class=\"gt_row gt_left\">Allen Lazard</td>\n<td class=\"gt_row gt_left\">T.J. Hockenson</td>\n<td class=\"gt_row gt_left\">DeSean Jackson</td>\n<td class=\"gt_row gt_left\">Larry Fitzgerald</td>\n<td class=\"gt_row gt_left\">Bryan Edwards</td>\n<td class=\"gt_row gt_left\">Christopher Herndon</td>\n<td class=\"gt_row gt_left\">TEN  Def</td></tr>\n    <tr><td class=\"gt_row gt_right\">15</td>\n<td class=\"gt_row gt_left\">Devonta Freeman</td>\n<td class=\"gt_row gt_left\">LAC  Def</td>\n<td class=\"gt_row gt_left\">MIN  Def</td>\n<td class=\"gt_row gt_left\">Ryquell Armstead</td>\n<td class=\"gt_row gt_left\">DK Metcalf</td>\n<td class=\"gt_row gt_left\">A.J. Dillon</td>\n<td class=\"gt_row gt_left\">Sammy Watkins</td>\n<td class=\"gt_row gt_left\">IND  Def</td>\n<td class=\"gt_row gt_left\">Parris Campbell</td>\n<td class=\"gt_row gt_left\">Mike Gesicki</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nThis was the initial draft board. My team was the 9th slot. I traded away Julio Jones and cut Odell Beckham Jr. after he went to Injured Reserve. There needs to be a logic to represent these moves, as they are no longer eligible to keep.\n\nIn addition to structuring the rules, I would like to:\n\n-   Provide color the names by each player's position, as is typical on most fantasy football draft boards.\n-   Allow multiple players to occupy a draft slot. In the case of a traded player, there can be overlap on eligible keepers for one team in a particular round .\n\nThese can not be done with a pivot table (at least not without hardcoding elements). The final output will need to be in a **tidy** format to allow usage of the grammar of graphics in **{ggplot2}**.\n\n### Ineligible Keepers\n\nTo start with, create a list of the players kept from 2019 in 2020. The players are no longer eligible and need to be filtered out.\n\nThe NFL and fantasy football is played weekly. Using the **{lubridate}**, create week 1 of the NFL season from the *timestamp* field in the transactions data frame.\n\nTo get the players that were dropped early in advance of their bye week:\n\n-   Filter for transactions that successfully dropped players\n-   Add in each teams bye week\n-   Get the earliest *drop* (each player can be added/dropped multiple times throughout the season)\\\n-   Subset as a list of unique names\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkept_players <- c(\n  'Lamar Jackson',\n  'Josh Jacobs',\n  'Austin Ekeler',\n  'Aaron Jones',\n  'DK Metcalf',\n  'Kenyan Drake',\n  'Courtland Sutton',\n  'Josh Allen',\n  'D.J. Moore',\n  'Derrick Henry'\n)  \n\ntransactions <- transactions %>% \n  mutate(week = lubridate::week(timestamp) - 36)\n\n\ndropped_players <- transactions %>% \n  filter(type_desc == 'dropped') %>% \n  filter(type != 'waiver_failed') %>% \n  mutate(\n    bye_weeks = case_when(\n      team %in% c(\"PIT\", \"TEN\") ~ 4,\n      team %in% c(\"DEN\", \"DET\", \"GB\", \"NE\") ~ 5,\n      team %in% c(\"LV\", \"LAC\", \"NO\", \"SEA\") ~ 6,\n      team %in% c(\"BAL\", \"IND\", \"MIA\", \"MIN\") ~ 7,\n      team %in% c(\"ARI\", \"HOU\", \"JAX\", \"WAS\") ~ 8,\n      team %in% c(\"CIN\", \"CLE\", \"LAR\", \"PHI\") ~ 9,\n      team %in% c(\"ATL\", \"DAL\", \"KC\", \"NYJ\") ~ 10,\n      team %in% c(\"BUF\", \"CHI\", \"NYG\", \"SF\") ~ 11,\n      team %in% c(\"CAR\", \"TB\") ~ 13\n    )\n  ) %>% \n  group_by(player_name, player_id) %>% \n  arrange(timestamp, player_id) %>% \n  mutate(rn = row_number()) %>% \n  filter(rn == 1) %>% \n  filter(week < bye_weeks - 1) %>% \n  #filter(franchise_id == 1) %>% print(n= 32)\n  pull(player_name) %>% \n  unique()\n```\n:::\n\n\n### Traded Players\n\n**{ffscrapr}** does so much of the leg work for you. In the transactions of the trade, a field *trade_partner* is already included which contains the ID of who the trade went to.\n\nAgain, follow a similar logic to most recent occurrence of the traded player. For example, Michael Gallup was traded 3 times in our league. He needs to be placed on the final team he ended up on.\n\nA separate table *franchises* was created to join the *franchise_name* to the output.\n\nFinally, I created a list of the names in our league. If you didn't see my previous work, you might notice the 9th spot did not turn out so well.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfranchises <- draft_picks %>% \n  count(franchise_id, franchise_name, pick) %>% \n  select(-n) \n\ntrades <- transactions %>% \n  filter(type == 'trade') %>% \n  group_by(player_name) %>% \n  arrange(timestamp) %>% \n  mutate(rn = row_number()) %>% \n  filter(rn == max(rn)) %>% \n  select(franchise_id, franchise_name, player_name, trade_partner) %>%\n  mutate(trade_partner = as.numeric(trade_partner)) %>% \n  left_join(\n    franchises, by = c(\"trade_partner\"=\"franchise_id\"), suffix = c(\"\",\"_trade\")\n  ) \n\nusers <- c(\n  'CHAMP',\n  'Wayne',\n  'Jacob',\n  'Tony',\n  'Ben',\n  'Clayton',\n  'Zach',\n  'Mitch',\n  'Last Place',\n  'Connor'\n)\n```\n:::\n\n\n## The Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndraft_picks %>% \n  filter(round != 1) %>% \n  mutate(round = round - 1) %>% \n  mutate(url = glue::glue(\n    \"https://sleepercdn.com/content/nfl/players/thumb/{player_id}.jpg\"\n  )) %>% \n  bind_rows(\n    tibble(\n      round = rep(0, 10), \n      player_name = users,\n      pick = 1:10\n      )\n    ) %>% \n  filter(!player_name %in% dropped_players & !player_name %in% kept_players) %>%\n  left_join(\n    trades, \n    by = c(\"franchise_name\", \"player_name\"),\n    suffix = c(\"\", \"_trade\")\n  ) %>% \n  mutate(pick = ifelse(\n    !is.na(pick_trade) & round != 0,\n    pick_trade, \n    pick\n    )) %>% \n  group_by(round, pick) %>% \n  mutate(hjust = n(),\n         hjust_n = row_number()) %>% \n  ungroup() %>% \n  mutate(player_name = case_when(\n    player_name == 'Clyde Edwards-Helaire'~'C. Edwards-Helaire',\n    TRUE ~ player_name\n  )) %>% \n  ggplot(aes(pick, round)) +\n  geom_point(alpha = 0) +\n  geom_label(\n    aes(label = player_name, fill = pos), \n    show.legend = F, \n    data = . %>% filter(round > 0, hjust > 1, hjust_n == 1),\n    vjust = 1,\n    size = 5\n  ) +\n  geom_label(\n    aes(label = player_name, fill = pos),\n    size = 5, \n    show.legend = F, \n    data = . %>% filter(round > 0, hjust > 1, hjust_n == 2),\n    vjust = -0.1\n  ) +\n  geom_label(\n    aes(label = player_name, fill = pos), \n    size = 5, \n    show.legend = F, \n    data = . %>% filter(round > 0, hjust == 1)\n    ) +\n  geom_text(\n    aes(label = player_name),\n    data = . %>% \n      filter(round == 0),\n    size = 7,\n    color = \"#FFFFFF\"\n  ) +\n  scale_y_reverse(breaks = c(1:15)) +\n  theme_minimal() +\n  labs(\n    title = \"Keepers 2021\",\n    x = NULL,\n    y = NULL\n  ) +\n  theme(\n    panel.grid = element_blank(),\n    axis.text.x = element_blank(),\n    axis.text.y = element_text(color=\"#FFFFFF\", size = 18),\n    plot.title = element_text(size = 30, face = \"bold\", hjust = 0.5, color = \"#FFFFFF\"),\n    plot.background = element_rect(fill = \"#494f5c\"),\n  ) +\n  geom_hline(yintercept = 0.5) +\n  geom_hline(yintercept = seq(1.5, 13.5, 1), alpha = 0.5) +\n  scale_fill_manual(\n    values =  c(\"#d65858\",\"#00ba5d\",\"#ff7c43\", \"#58ffff\")\n  )\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](img/keepers.png){width=100%}\n:::\n:::\n\n\nI've included the code on how I created the plot, however I've cut a corner by not having the code evaluated at runtime, and the static image is passed through.\n\nI still have a lot to learn with **{ggplot2}**, especially when it comes to rendering the graphic in dimensions needed. Overall it was a neat problem thinking about how to represent the draftboard.\n\nThat wraps up this project. Thanks again to [Tan](https://twitter.com/_TanHo) for the awesome package!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}